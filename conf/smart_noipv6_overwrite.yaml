# æœºåœºè®¢é˜…
proxy-providers:
  WD:
    url: "url"
    type: http
    proxy: Mainland
  NB:
    url: "url"
    type: http
    proxy: Mainland
    filter: "^((?!(æ›´æ–°|å®¢æˆ·ç«¯|æ˜¾ç¤º|æ•™ç¨‹)).)*$"
  WM:
    url: "url"
    type: http
    proxy: Mainland
    filter: "^((?!(æµ‹è¯•|å®¢æˆ·ç«¯|å®˜ç½‘|æ•™ç¨‹)).)*$"
  XZY:
    url: "url"
    type: http
    proxy: Mainland
    filter: "^((?!(æµ‹è¯•|å®¢æˆ·ç«¯|å®˜ç½‘|æ•™ç¨‹|æ›´æ–°|TGç¾¤|é‡ç½®|ISP)).)*$"
    
# åŸºæœ¬ä»£ç†
# ç”¨äºè®¢é˜…å’Œæ‹’ç»è¿æ¥
proxies:
  - { name: Mainland, type: direct, udp: true }
  - { name: Reject, type: reject, udp: true }

# ç«¯å£åŠå…¨å±€è®¾ç½®
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7895
mode: rule
allow-lan: true
ipv6: false
log-level: warning
external-controller: 0.0.0.0:9090
bind-address: "*"
find-process-mode: "off" #æ€§èƒ½å¼€é”€å¤§ mt3000ä¸é€‚åˆå¼€
keep-alive-interval: 15
keep-alive-idle: 600
global-client-fingerprint: chrome

# é…ç½®å­˜å‚¨
profile:
  store-selected: true
  store-fake-ip: true
  
# geo é“¾æ¥
# é‡‡ç”¨ https://github.com/MetaCubeX/meta-rules-dat/tree/master é¡¹ç›®ä¸­çš„æ–‡ä»¶
geox-url:
  mmdb: https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb
  geoip: https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat
  geosite: https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat
  asn: https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/GeoLite2-ASN.mmdb

# å®éªŒæ€§åŠŸèƒ½
experimental:
  quic-go-disable-gso: true 

# TUN æ¨¡å¼é…ç½®
tun:
  enable: false
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  
# å—…æ¢é“¾æ¥
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.netflix.com"
    - "+.nflxvideo.net"
    - "+.amazonaws.com"
    - "+.v2ex.com"
    - "+.media.dssott.com"
  skip-domain:
    - "+.apple.com"
    - Mijia Cloud
    - dlg.io.mi.com
    - "+.oray.com"
    - "+.sunlogin.net"
    - "+.push.apple.com"
  parse-pure-ip: true

# DNS è®¾ç½®
dns:
  enable: true
  cache-algorithm: arc
  listen: 0.0.0.0:7874
  ipv6: false
  respect-rules: true
  default-nameserver:
    - https://223.5.5.5/dns-query
  proxy-server-nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  nameserver:
    - 202.103.24.68
    - 119.29.29.29
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    - geosite:cn
    - "rule-set:fakeipfilter_domain,direct_list"

# ç­–ç•¥ç»„
# ç­–ç•¥ç»„å®šä¹‰é”š
group1: &group1
  type: select
  proxies:
    - Mainland
    - NB-manual
    - WD-manual
    - WM-manual
    - XZY-manual
    - HK-manual
    - TW-manual
    - JP-manual
    - KR-manual
    - SG-manual
    - US-manual
    - Reject

group2: &group2
  type: select
  proxies:
    - Mainland
    - NB-manual
    - WD-manual
    - WM-manual
    - XZY-manual
    - HK-smart
    - TW-smart
    - SG-smart
    - JP-smart
    - KR-smart
    - US-smart
    - EU-smart
    - HK-manual
    - TW-manual
    - JP-manual
    - KR-manual
    - SG-manual
    - US-manual
    - Reject

# åº”ç”¨ç­–ç•¥å±‚ - Selectæ‰‹åŠ¨é€‰æ‹©ï¼Œæ”¯æŒå¤šåœºæ™¯åº”ç”¨ä¼˜åŒ–
proxy-groups:
  - { name: Proxy, <<: *group1 }
  - { name: GlobalDirect, <<: *group1 }
  - { name: Hentai, <<: *group2 }
  - { name: HentaiRegion, <<: *group2 }
  - { name: StreamMedia, <<: *group2 }
  - { name: SocialMedia, <<: *group2 }
  - { name: Scholar, <<: *group1 }
  - { name: AI, <<: *group1 }
  - { name: Google, <<: *group1 }
  - { name: Microsoft, <<: *group1 }
  - { name: Github, <<: *group1 }
  - { name: Pikpak, <<: *group1 }
  - { name: Apple, <<: *group1 }
  - { name: Block, <<: *group1 }
  - { name: Match, <<: *group2 }

  # æœºåœºç»„-æ‰‹åŠ¨
  - name: NB-manual
    type: select
    use:
      - NB
    url: "https://www.gstatic.com/generate_204"
    interval: 200
    filter: "^((?!(æµé‡|å®˜ç½‘|è¶…æ—¶|xianzheyun|ISP|é‡ç½®|åˆ°æœŸ)).)*$"

  - name: WD-manual
    type: select
    use:
      - WD
    url: "https://www.gstatic.com/generate_204"
    interval: 3600
    filter: "^((?!(Traffic|Expire)).)*$"
    
  - name: WM-manual
    type: select
    use:
      - WM
    url: "https://www.gstatic.com/generate_204"
    interval: 1800
    filter: "^((?!(å®˜ç½‘|å®¢æˆ·ç«¯)).)*$"

  - name: XZY-manual
    type: select
    use:
      - XZY
    url: "https://www.gstatic.com/generate_204"
    interval: 200
    filter: "^((?!(å®˜ç½‘|å®¢æˆ·ç«¯|æµé‡|é‡ç½®|åˆ°æœŸ)).)*$"

# åœ°ç†ç­–ç•¥å±‚-æ‰‹åŠ¨
  - name: HK-manual
    type: select
    include-all: true
    filter: "(?i)æ¸¯|é¦™æ¸¯|ğŸ‡­ğŸ‡°|HK|Hong Kong|hongkong"

  - name: TW-manual
    type: select
    include-all: true
    filter: "(?i)å°|å°æ¹¾|æ–°åŒ—|å½°åŒ–|TW|Taiwan|taiwan"

  - name: JP-manual
    type: select
    include-all: true
    filter: "(?i)æ—¥|æ—¥æœ¬|ğŸ‡¯ğŸ‡µ|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|JP|Japan"

  - name: KR-manual
    type: select
    include-all: true
    filter: "(?i)éŸ©|éŸ©å›½|KR|Korea"
    
  - name: SG-manual
    type: select
    include-all: true
    filter: "(?i)æ–°åŠ å¡|ğŸ‡¸ğŸ‡¬|å¡|ç‹®åŸ|SG|Singapore"

  - name: US-manual
    type: select
    include-all: true
    filter: "((?i)ç¾|ç¾å›½|æ³¢ç‰¹å…°|çº½çº¦|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|United States)"

# åœ°ç†ç­–ç•¥å±‚-æ™ºèƒ½ 
# æ”¿ç­–æƒé‡æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆåˆ«çš„é…ç½®éƒ½è¯´åäº†
  - name: HK-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)é¦™æ¸¯"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

  - name: TW-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)å°æ¹¾"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

  - name: SG-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)æ–°åŠ å¡"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

  - name: JP-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)æ—¥æœ¬"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true
    
  - name: KR-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)éŸ©å›½"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true
    
  - name: US-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)ç¾å›½|æ‹‰æ–¯ç»´åŠ æ–¯|å‡¤å‡°åŸ|çº½çº¦"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

  - name: EU-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)å¾·å›½|è‹±å›½|åŠ æ‹¿å¤§"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

# è§„åˆ™åŒ¹é…
# æŠŠå°çš„ï¼Œéœ€è¦ä¼˜å…ˆåŒ¹é…çš„è§„åˆ™æ”¾åœ¨å‰é¢ï¼Œå¤§çš„å…œåº•çš„è§„åˆ™æ”¾åœ¨åé¢
# ä¼˜å…ˆä½¿ç”¨ geositeï¼Œgeoipçš„è§„åˆ™
# geositeï¼Œgeoip çš„åå­—å¯ä»¥å‚è€ƒ https://github.com/MetaCubeX/meta-rules-dat/tree/meta é¡¹ç›®
# ä¸Šè¿°é¡¹ç›®çš„è§„åˆ™ä¹Ÿå¯ä»¥é€šè¿‡ ruleset çš„æ–¹å¼å¼•å…¥
rules:
  # æ‹¦æˆªè§„åˆ™
  - AND,((DST-PORT,443),(NETWORK,UDP)),REJECT  # é˜»æ­¢ QUIC
  # è‡ªå®šä¹‰ç»´æŠ¤è§„åˆ™
  - RULE-SET,dns_list,GlobalDirect
  - RULE-SET,direct_list,GlobalDirect
  - RULE-SET,direct_ip,GlobalDirect,no-resolve
  - RULE-SET,hk_list,HK-manual
  - RULE-SET,tw_list,TW-manual
  - RULE-SET,sg_list,SG-manual
  - RULE-SET,jp_list,JP-manual
  - RULE-SET,kr_list,KR-manual
  - RULE-SET,us_list,US-manual
  - RULE-SET,pikpak_list,Pikpak
  - RULE-SET,pikpak_ip,Pikpak,no-resolve
  - RULE-SET,hentai_list,Hentai
  - RULE-SET,hentairegion_list,HentaiRegion
  - RULE-SET,scholar_list,Scholar
  - RULE-SET,service_list,Github
  - RULE-SET,social_list,SocialMedia
  - RULE-SET,media_list,StreamMedia
  - RULE-SET,proxy_list,Proxy
  # æ•°æ®åº“è§„åˆ™ å…·ä½“å¸¸ç”¨éœ€æå‰åŒ¹é…
  - GEOSITE,pikpak,Pikpak
  - GEOSITE,dmm,JP-manual
  - GEOSITE,ehentai,Hentai
  - GEOSITE,youjizz,Hentai
  - GEOSITE,pixiv,JP-manual
  - GEOSITE,dlsite,JP-manual
  - GEOSITE,xvideos,HentaiRegion
  - GEOSITE,spankbang,HentaiRegion
  - GEOSITE,xhamster,HentaiRegion
  - GEOSITE,x,SocialMedia
  - GEOIP,twitter,SocialMedia,no-resolve
  - GEOSITE,telegram,SocialMedia
  - GEOIP,telegram,SocialMedia,no-resolve
  - GEOSITE,youtube,StreamMedia
  - GEOSITE,apple,Apple
  - GEOSITE,github,Github
  - GEOSITE,onedrive,Microsoft
  - GEOSITE,microsoft,Microsoft
  - GEOIP,google,Google,no-resolve
  - GEOSITE,google,Google
  # æ•°æ®åº“è§„åˆ™ å…œåº•
  - GEOSITE,category-ai-!cn,AI
  - GEOSITE,category-social-media-!cn,SocialMedia
  - GEOSITE,category-scholar-!cn,Scholar
  - GEOSITE,category-porn,Hentai
  - GEOSITE,gfw,Proxy
  - GEOSITE,geolocation-!cn,Proxy
  - GEOSITE,private,GlobalDirect
  - GEOSITE,cn,GlobalDirect
  - GEOIP,cn,GlobalDirect,no-resolve
  - RULE-SET,block_domain,Block
  # æœ€ç»ˆå…œåº•
  - MATCH,Match

# è§„åˆ™é›†
rule-anchor:
  ip: &ip { type: http, interval: 86400, behavior: ipcidr, format: mrs }
  domain: &domain { type: http, interval: 86400, behavior: domain, format: mrs }
  class: &class { type: http, interval: 86400, behavior: classical, format: text }

rule-providers:
# è‡ªå®šä¹‰ç»´æŠ¤è§„åˆ™
  dns_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/dns.list",
    }
  direct_ip:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/direct.ip",
    }
  direct_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/direct.list",
    }
  pikpak_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/pikpak.list",
    }
  pikpak_ip:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/pikpak.ip",
    }
  hentai_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/hentai.list",
    }
  hentairegion_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/hentai_region.list",
    }
  hk_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/hk.list",
    }
  tw_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/tw.list",
    }
  sg_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/sg.list",
    }
  jp_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/jp.list",
    }
  kr_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/kr.list",
    }
  us_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/us.list",
    }
  proxy_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/proxy.list",
    }
  scholar_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/scholar.list",
    }
  media_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/media.list",
    }
  service_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/service.list",
    }
  ai_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/ai.list",
    }
  social_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/social.list",
    }

# é¢å¤–è§„åˆ™  
  block_domain:
    {
      <<: *class,
      url: "https://gh-proxy.com/raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/Block.list",
    }
  fakeipfilter_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/wwqgtxx/clash-rules/release/fakeip-filter.mrs",
    }
