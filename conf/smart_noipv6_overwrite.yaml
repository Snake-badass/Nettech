# æœºåœºè®¢é˜…
proxy-providers:
  WD:
    url: "url"
    type: http
    proxy: Mainland
  NB:
    url: "url"
    type: http
    proxy: Mainland
    interval: 1440
    filter: "^((?!(æ›´æ–°|å®¢æˆ·ç«¯|æ˜¾ç¤º|æ•™ç¨‹)).)*$"
  WM:
    url: "url"
    type: http
    proxy: Mainland
    filter: "^((?!(æµ‹è¯•|å®¢æˆ·ç«¯|å®˜ç½‘|æ•™ç¨‹)).)*$"
  XZY:
    url: "url"
    type: http
    proxy: Mainland
    interval: 1440
    filter: "^((?!(æµ‹è¯•|å®¢æˆ·ç«¯|å®˜ç½‘|æ•™ç¨‹|æ›´æ–°|TGç¾¤|é‡ç½®|ISP)).)*$"
    
# åŸºæœ¬ä»£ç†
# ç”¨äºè®¢é˜…å’Œæ‹’ç»è¿æ¥
proxies:
  - { name: Mainland, type: direct, udp: true }
  - { name: Reject, type: reject, udp: true }

# ç«¯å£åŠå…¨å±€è®¾ç½®
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7895
mode: rule
allow-lan: true
ipv6: false
log-level: warning
external-controller: 0.0.0.0:9090
bind-address: "*"
find-process-mode: "off" #æ€§èƒ½å¼€é”€å¤§ mt3000ä¸é€‚åˆå¼€
keep-alive-interval: 15
keep-alive-idle: 600
global-client-fingerprint: chrome

# é…ç½®å­˜å‚¨
profile:
  store-selected: true
  store-fake-ip: true
  
# geo é“¾æ¥
geox-url:
  mmdb: https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/Country.mmdb
  geoip: https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat
  geosite: https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat
  asn: https://testingcf.jsdelivr.net/gh/xishang0128/geoip@release/GeoLite2-ASN.mmdb

# å®éªŒæ€§åŠŸèƒ½
experimental:
  quic-go-disable-gso: true 

# TUN æ¨¡å¼é…ç½®
tun:
  enable: false
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  
# å—…æ¢é“¾æ¥
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.netflix.com"
    - "+.nflxvideo.net"
    - "+.amazonaws.com"
    - "+.v2ex.com"
    - "+.media.dssott.com"
  skip-domain:
    - "+.apple.com"
    - Mijia Cloud
    - dlg.io.mi.com
    - "+.oray.com"
    - "+.sunlogin.net"
    - "+.push.apple.com"
  parse-pure-ip: true

# DNS è®¾ç½®
dns:
  enable: true
  cache-algorithm: arc
  listen: 0.0.0.0:7874
  ipv6: false
  respect-rules: true
  default-nameserver:
    - https://223.5.5.5/dns-query
  proxy-server-nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  nameserver:
    - 202.103.24.68
    - 119.29.29.29
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    - geosite:cn
    - "rule-set:private_domain,cn_domain,fakeipfilter_domain,direct_list"

# ç­–ç•¥ç»„
# ç­–ç•¥ç»„å®šä¹‰é”š
group1: &group1
  type: select
  proxies:
    - Mainland
    - NB-manual
    - WD-manual
    - WM-manual
    - XZY-manual
    - HK-manual
    - TW-manual
    - JP-manual
    - SG-manual
    - US-manual
    - All-manual
    - Reject

group2: &group2
  type: select
  proxies:
    - Mainland
    - NB-manual
    - WD-manual
    - WM-manual
    - XZY-manual
    - HK-smart
    - TW-smart
    - SG-smart
    - JP-smart
    - KR-smart
    - US-smart
    - EU-smart
    - HK-manual
    - TW-manual
    - JP-manual
    - SG-manual
    - US-manual
    - All-manual
    - Reject

# åº”ç”¨ç­–ç•¥å±‚ - Selectæ‰‹åŠ¨é€‰æ‹©ï¼Œæ”¯æŒå¤šåœºæ™¯åº”ç”¨ä¼˜åŒ–
proxy-groups:
  - { name: Proxy, <<: *group1 }
  - { name: Hentai, <<: *group2 }
  - { name: HentaiRegion, <<: *group2 }
  - { name: StreamMedia, <<: *group2 }
  - { name: SocialMedia, <<: *group2 }
  - { name: Pikpak, <<: *group1 }
  - { name: AI, <<: *group1 }
  - { name: Google, <<: *group1 }
  - { name: Microsoft, <<: *group1 }
  - { name: Github, <<: *group1 }
  - { name: Scholar, <<: *group1 }
  - { name: Apple, <<: *group1 }
  - { name: GlobalDirect, <<: *group1 }
  - { name: Block, <<: *group1 }
  - { name: Match, <<: *group2 }

  # æœºåœºç»„-æ‰‹åŠ¨
  - name: NB-manual
    type: select
    use:
      - NB
    url: "https://www.gstatic.com/generate_204"
    interval: 200
    filter: "^((?!(æµé‡|å®˜ç½‘|è¶…æ—¶|xianzheyun|ISP|é‡ç½®|åˆ°æœŸ)).)*$"

  - name: WD-manual
    type: select
    use:
      - WD
    url: "https://www.gstatic.com/generate_204"
    interval: 3600
    filter: "^((?!(Traffic|Expire)).)*$"
    
  - name: WM-manual
    type: select
    use:
      - WM
    url: "https://www.gstatic.com/generate_204"
    interval: 1800
    filter: "^((?!(å®˜ç½‘|å®¢æˆ·ç«¯)).)*$"

  - name: XZY-manual
    type: select
    use:
      - XZY
    url: "https://www.gstatic.com/generate_204"
    interval: 200
    filter: "^((?!(å®˜ç½‘|å®¢æˆ·ç«¯|æµé‡|é‡ç½®|åˆ°æœŸ)).)*$"

# åœ°ç†ç­–ç•¥å±‚-æ‰‹åŠ¨
  - name: HK-manual
    type: select
    include-all: true
    filter: "(?i)æ¸¯|é¦™æ¸¯|ğŸ‡­ğŸ‡°|HK|Hong Kong|hongkong"

  - name: TW-manual
    type: select
    include-all: true
    filter: "(?i)å°|å°æ¹¾|æ–°åŒ—|å½°åŒ–|TW|Taiwan|taiwan"

  - name: JP-manual
    type: select
    include-all: true
    filter: "(?i)æ—¥|æ—¥æœ¬|ğŸ‡¯ğŸ‡µ|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|JP|Japan"

  - name: SG-manual
    type: select
    include-all: true
    filter: "(?i)æ–°åŠ å¡|ğŸ‡¸ğŸ‡¬|å¡|ç‹®åŸ|SG|Singapore"

  - name: US-manual
    type: select
    include-all: true
    filter: "((?i)ç¾|ç¾å›½|æ³¢ç‰¹å…°|çº½çº¦|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|United States)"

  - name: All-manual
    type: select
    use:
      - NB
      - WD
      - WM
      - XZY
    filter: "^((?!(æµé‡|å®˜ç½‘|è¶…æ—¶|xianzheyun|ISP|é‡ç½®|åˆ°æœŸ|Traffic|Expire)).)*$"

# åœ°ç†ç­–ç•¥å±‚-æ™ºèƒ½ 
# æ”¿ç­–æƒé‡æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆåˆ«çš„é…ç½®éƒ½è¯´åäº†
  - name: HK-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)é¦™æ¸¯"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

  - name: TW-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)å°æ¹¾"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

  - name: SG-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)æ–°åŠ å¡"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

  - name: JP-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)æ—¥æœ¬"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true
    
  - name: KR-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)éŸ©å›½"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true
    
  - name: US-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)ç¾å›½|æ‹‰æ–¯ç»´åŠ æ–¯|å‡¤å‡°åŸ|çº½çº¦"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

  - name: EU-smart
    type: smart
    use:
      - NB
      - XZY
    filter: "(?i)å¾·å›½|è‹±å›½|åŠ æ‹¿å¤§"
    uselightgbm: true
    collectdata: false
    policy-priority: "(?i)0.5x:1.5"
    interval: 200
    prefer-asn: true

# è§„åˆ™åŒ¹é…
rules:
  # Force match
  # æ‹¦æˆªè§„åˆ™
  - AND,((DST-PORT,443),(NETWORK,UDP)),REJECT  # é˜»æ­¢ QUIC
  # self-defined rulesets
  - RULE-SET,dns_list,GlobalDirect
  - RULE-SET,direct_list,GlobalDirect
  - RULE-SET,direct_ip,GlobalDirect # é…ç½®æ–‡ä»¶ä¸­å«æœ‰ no-resolve
  - RULE-SET,hk_list,HK-manual
  - RULE-SET,tw_list,TW-manual
  - RULE-SET,sg_list,SG-manual
  - RULE-SET,jp_list,JP-manual
  - RULE-SET,kr_list,JP-manual
  - RULE-SET,us_list,US-manual
  - RULE-SET,pikpak_list,Pikpak
  - RULE-SET,pikpak_ip,Pikpak # é…ç½®æ–‡ä»¶ä¸­å«æœ‰ no-resolve
  - RULE-SET,hentai_list,Hentai
  - RULE-SET,hentairegion_list,HentaiRegion
  - RULE-SET,scholar_list,Scholar
  - RULE-SET,service_list,Github
  - RULE-SET,ai_list,AI
  - RULE-SET,social_list,SocialMedia
  - RULE-SET,media_list,StreamMedia
  - RULE-SET,proxy_list,Proxy
  - RULE-SET,Custom_Proxy,Proxy # é…ç½®æ–‡ä»¶ä¸­å«æœ‰ no-resolve
  # pre-defined rulesets
  - RULE-SET,apple@cn_domain,Apple
  - RULE-SET,apple_domain,Apple
  - RULE-SET,steam_CDN,GlobalDirect
  - RULE-SET,pikpak_domain,Pikpak
  - RULE-SET,dmm_domain,JP-manual
  - RULE-SET,github_domain,Github
  - RULE-SET,x_domain,SocialMedia
  - RULE-SET,telegram_domain,SocialMedia
  - RULE-SET,telegram_ip,SocialMedia,no-resolve
  - RULE-SET,youtube_domain,StreamMedia
  - RULE-SET,category-social-media-!cn_domain,SocialMedia
  - RULE-SET,category-scholar-!cn_domain,Scholar
  - RULE-SET,category-porn_domain,Hentai
  - RULE-SET,ai,AI
  - RULE-SET,onedrive_domain,Microsoft
  - RULE-SET,microsoft_domain,Microsoft
  - RULE-SET,google_ip,Google,no-resolve
  - RULE-SET,google_domain,Google
  - RULE-SET,gfw_domain,Proxy
  - RULE-SET,geolocation-!cn,Proxy
  - RULE-SET,private_domain,GlobalDirect
  - RULE-SET,cn_domain,GlobalDirect
  - RULE-SET,cn_ip,GlobalDirect,no-resolve
  - RULE-SET,category-ads-all_domain,Block
  - RULE-SET,block_domain,Block
  - MATCH,Match

# è§„åˆ™é›†
rule-anchor:
  ip: &ip { type: http, interval: 86400, behavior: ipcidr, format: mrs }
  domain: &domain { type: http, interval: 86400, behavior: domain, format: mrs }
  class: &class { type: http, interval: 86400, behavior: classical, format: text }

rule-providers:
  Custom_Proxy:
    behavior: classical
    interval: 86400
    path: ./rule_provider/Custom_Proxy_Classical.yaml
    type: http
    url: "https://raw.githubusercontent.com/Aethersailor/Custom_OpenClash_Rules/refs/heads/main/rule/Custom_Proxy_Classical.yaml"
    
  Steam_CDN:
    behavior: classical
    interval: 86400
    path: ./rule_provider/Steam_CDN_Classical.yaml
    type: http
    url: "https://raw.githubusercontent.com/Aethersailor/Custom_OpenClash_Rules/refs/heads/main/rule/Steam_CDN_Classical.yaml"
    
  fakeipfilter_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/wwqgtxx/clash-rules/release/fakeip-filter.mrs",
    }
  dns_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/dns.list",
    }
  direct_ip:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/direct.ip",
    }
  direct_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/direct.list",
    }
  pikpak_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/pikpak.list",
    }
  pikpak_ip:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/pikpak.ip",
    }
  hentai_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/hentai.list",
    }
  hentairegion_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/hentai_region.list",
    }
  hk_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/hk.list",
    }
  tw_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/tw.list",
    }
  sg_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/sg.list",
    }
  jp_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/jp.list",
    }
  kr_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/kr.list",
    }
  us_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/us.list",
    }
  proxy_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/proxy.list",
    }
  scholar_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/scholar.list",
    }
  media_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/media.list",
    }
  service_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/service.list",
    }
  ai_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/ai.list",
    }
  social_list:
    {
      <<: *class,
      url: "https://raw.githubusercontent.com/Snake-badass/Nettech/refs/heads/main/rules/social.list",
    }
  apple_domain:
    {
      <<: *domain,
      url: "https://gh-proxy.com/github.com/metacubex/meta-rules-dat/raw/refs/heads/meta/geo/geosite/apple.mrs",
    }
  block_domain:
    {
      <<: *class,
      url: "https://gh-proxy.com/raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/Block.list",
    }
  private_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs",
    }
  ai:
    {
      <<: *domain,
      url: "https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/category-ai-!cn.mrs",
    }
  youtube_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.mrs",
    }
  google_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs",
    }
  github_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.mrs",
    }
  telegram_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.mrs",
    }
  onedrive_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/onedrive.mrs",
    }
  microsoft_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs",
    }
  apple@cn_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/apple@cn.mrs",
    }
  x_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/x.mrs",
    }
  category-social-media-!cn_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/category-social-media-!cn.mrs",
    }
  category-porn_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/category-porn.mrs",
    }
  category-scholar-!cn_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/category-scholar-!cn.mrs",
    }
  category-ads-all_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/category-ads-all.mrs",
    }
  dmm_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/dmm.mrs",
    }
  pikpak_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/pikpak.mrs",
    }
  gfw_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/gfw.mrs",
    }
  geolocation-!cn:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs",
    }
  cn_domain:
    {
      <<: *domain,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs",
    }
  cn_ip:
    {
      <<: *ip,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs",
    }
  google_ip:
    {
      <<: *ip,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.mrs",
    }
  telegram_ip:
    {
      <<: *ip,
      url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.mrs",
    }
